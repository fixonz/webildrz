<!DOCTYPE html>
<html lang="ro">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>VizualizeazƒÉ Site-ul Meu | WEB? DONE!</title>
    <meta name="description"
        content="Introdu ID-ul unic primit dupƒÉ generare pentru a-»õi vedea site-ul creat de WEB? DONE!">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ö°</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Inter:wght@400;500;600&display=swap"
        rel="stylesheet">
    <style>
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg: #05070a;
            --surface: #0c111d;
            --surface2: #161d2b;
            --border: rgba(255, 255, 255, 0.06);
            --accent: #00ffaa;
            --accent2: #00d4ff;
            --gold: #f7e16d;
            --text: #ffffff;
            --muted: #94a3b8;
            --success: #10b981;
            --premium: #ff3366;
            --radius: 24px;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
        }

        /* Ambient glow */
        body::before {
            content: '';
            position: fixed;
            top: -30%;
            left: -20%;
            width: 70%;
            height: 70%;
            background: radial-gradient(ellipse, rgba(108, 99, 255, 0.12) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
        nav {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(8, 11, 20, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
        }

        .logo {
            font-family: 'Syne', sans-serif;
            font-weight: 800;
            font-size: 1.2rem;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo span {
            -webkit-text-fill-color: var(--gold);
        }

        .nav-back {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 100px;
            color: var(--muted);
            font-size: 0.82rem;
            font-weight: 600;
            text-decoration: none;
            transition: color 0.2s, border-color 0.2s;
        }

        .nav-back:hover {
            color: var(--text);
            border-color: rgba(255, 255, 255, 0.15);
        }

        /* ‚îÄ‚îÄ LOOKUP SCREEN ‚îÄ‚îÄ */
        #lookup-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 32px 20px;
            position: relative;
            z-index: 1;
        }

        .lookup-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 229, 160, 0.1);
            border: 1px solid rgba(0, 229, 160, 0.25);
            color: var(--success);
            padding: 8px 18px;
            border-radius: 100px;
            font-size: 0.78rem;
            font-weight: 700;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            margin-bottom: 28px;
        }

        #lookup-screen h1 {
            font-family: 'Syne', sans-serif;
            font-size: clamp(2rem, 7vw, 3.5rem);
            font-weight: 800;
            text-align: center;
            line-height: 1.1;
            margin-bottom: 14px;
            letter-spacing: -0.03em;
        }

        #lookup-screen h1 em {
            font-style: normal;
            background: linear-gradient(90deg, var(--accent), var(--accent2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        #lookup-screen>p {
            color: var(--muted);
            text-align: center;
            font-size: 1rem;
            max-width: 380px;
            line-height: 1.65;
            margin-bottom: 40px;
        }

        .id-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 36px 28px;
            width: 100%;
            max-width: 420px;
            position: relative;
            overflow: hidden;
        }

        .id-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent), var(--accent2));
        }

        .id-label {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--muted);
            margin-bottom: 10px;
        }

        .id-input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }

        #site-id-input {
            flex: 1;
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 18px;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text);
            font-family: 'Syne', sans-serif;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        #site-id-input::placeholder {
            color: var(--muted);
            font-weight: 400;
            font-size: 0.9rem;
            letter-spacing: 0;
        }

        #site-id-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.15);
        }

        .btn-lookup {
            padding: 16px 20px;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.4rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 56px;
            box-shadow: 0 8px 24px rgba(108, 99, 255, 0.3);
        }

        .btn-lookup:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(108, 99, 255, 0.4);
        }

        .btn-lookup:active {
            transform: scale(0.96);
        }

        #error-msg {
            display: none;
            background: rgba(255, 60, 60, 0.1);
            border: 1px solid rgba(255, 60, 60, 0.25);
            color: #FF7070;
            border-radius: 10px;
            padding: 12px 16px;
            font-size: 0.88rem;
            margin-top: 4px;
            text-align: center;
        }

        .hint-text {
            margin-top: 20px;
            font-size: 0.8rem;
            color: var(--muted);
            text-align: center;
            line-height: 1.6;
        }

        .hint-text strong {
            color: var(--accent2);
        }

        /* ‚îÄ‚îÄ PREVIEW SCREEN ‚îÄ‚îÄ */
        #preview-screen {
            display: none;
            flex-direction: column;
            flex: 1;
        }

        .preview-top-bar {
            padding: 12px 16px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            flex-wrap: wrap;
        }

        .preview-site-info {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 0;
        }

        .preview-id-badge {
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            color: white;
            padding: 4px 12px;
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.05em;
            font-family: 'Syne', sans-serif;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .preview-biz-name {
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .preview-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .preview-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-family: 'Inter', sans-serif;
            white-space: nowrap;
        }

        .preview-btn-dl {
            background: var(--success);
            color: #0a1a14;
        }

        .preview-btn-dl:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(0, 229, 160, 0.3);
        }

        .preview-btn-back {
            background: var(--surface2);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .preview-btn-back:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .preview-btn-share {
            background: rgba(108, 99, 255, 0.15);
            color: var(--accent);
            border: 1px solid rgba(108, 99, 255, 0.3);
        }

        .preview-btn-share:hover {
            background: rgba(108, 99, 255, 0.25);
        }

        #site-iframe {
            flex: 1;
            width: 100%;
            border: none;
            min-height: calc(100dvh - 120px);
        }

        /* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
        #loading-screen {
            display: none;
            flex: 1;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            color: var(--muted);
            font-size: 0.95rem;
        }

        /* Share toast */
        #share-toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(80px);
            background: var(--success);
            color: #0a1a14;
            padding: 12px 24px;
            border-radius: 100px;
            font-weight: 700;
            font-size: 0.9rem;
            transition: transform 0.3s;
            z-index: 9999;
            white-space: nowrap;
        }

        #share-toast.show {
            transform: translateX(-50%) translateY(0);
        }

        /* Mobile tweaks */
        @media (max-width: 480px) {
            .preview-top-bar {
                padding: 10px 12px;
            }

            .preview-btn span {
                display: none;
            }

            .preview-btn {
                padding: 8px 10px;
            }
        }
    </style>
</head>

<body>

    <nav>
        <div class="logo">WEB<span>?</span> DONE!</div>
        <a href="/" class="nav-back">‚Üê Generator</a>
    </nav>

    <!-- LOOKUP SCREEN -->
    <div id="lookup-screen">
        <div class="lookup-badge">üîç Vizualizare Site</div>
        <h1>Site-ul tƒÉu,<br><em>oric√¢nd, oriunde.</em></h1>
        <p>Introdu codul unic de 8 caractere primit dupƒÉ generare pentru a-»õi vedea site-ul.</p>

        <div class="id-card">
            <div class="id-label">Codul tƒÉu unic</div>
            <div class="id-input-row">
                <input type="text" id="site-id-input" placeholder="ex: A1B2C3D4" maxlength="8" autocomplete="off"
                    autocorrect="off" spellcheck="false" inputmode="text">
                <button class="btn-lookup" id="btn-lookup" onclick="loadSite()">‚Üí</button>
            </div>
            <div id="error-msg">ID-ul introdus nu a fost gƒÉsit. VerificƒÉ codul primit prin WhatsApp sau email.</div>
            <div class="hint-text">
                Codul tƒÉu apare √Æn pagina de generare, imediat dupƒÉ ce site-ul este gata.<br>
                Exemplu: <strong>A1B2C3D4</strong>
            </div>
        </div>
    </div>

    <!-- LOADING -->
    <div id="loading-screen"
        style="display:none; flex:1; flex-direction:column; align-items:center; justify-content:center; gap:20px;">
        <div class="spinner"></div>
        <div class="loading-text">Se √ÆncarcƒÉ site-ul...</div>
    </div>

    <!-- PREVIEW SCREEN -->
    <div id="preview-screen">
        <div class="preview-top-bar">
            <div class="preview-site-info">
                <span class="preview-id-badge" id="preview-id">‚Äî‚Äî</span>
                <span class="preview-biz-name" id="preview-biz-name">Site-ul tƒÉu</span>
            </div>
            <div class="preview-actions">
                <button class="preview-btn preview-btn-share" onclick="shareLink()">üîó <span>PartajeazƒÉ</span></button>
                <button class="preview-btn preview-btn-dl" id="btn-dl">‚¨á <span>DescarcƒÉ</span></button>
                <button class="preview-btn preview-btn-back" onclick="goBack()">‚Ü© <span>Alt ID</span></button>
            </div>
        </div>
        <iframe id="site-iframe" srcdoc=""></iframe>
    </div>

    <div id="share-toast">‚úì Link copiat √Æn clipboard!</div>

    <script>
        const input = document.getElementById('site-id-input');
        const errorMsg = document.getElementById('error-msg');
        const lookupScreen = document.getElementById('lookup-screen');
        const loadingScreen = document.getElementById('loading-screen');
        const previewScreen = document.getElementById('preview-screen');
        const iframe = document.getElementById('site-iframe');
        const previewId = document.getElementById('preview-id');
        const previewBizName = document.getElementById('preview-biz-name');

        let currentHTML = '';
        let currentSiteId = '';

        // Auto-uppercase input
        input.addEventListener('input', () => {
            const val = input.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            input.value = val;
            errorMsg.style.display = 'none';
        });

        // Enter key support
        input.addEventListener('keydown', e => {
            if (e.key === 'Enter') loadSite();
        });

        // Check URL param on load
        window.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const idFromUrl = params.get('id');
            if (idFromUrl) {
                input.value = idFromUrl.toUpperCase().slice(0, 8);
                setTimeout(loadSite, 300);
            }
        });

        async function loadSite() {
            const siteId = input.value.trim().toUpperCase();
            if (siteId.length < 4) {
                showError('Introdu cel pu»õin 4 caractere din codul tƒÉu.');
                return;
            }

            // Show loading
            lookupScreen.style.display = 'none';
            loadingScreen.style.display = 'flex';
            previewScreen.style.display = 'none';
            errorMsg.style.display = 'none';

            try {
                const res = await fetch(`/api/site/${siteId}`);
                if (!res.ok) throw new Error('not_found');
                const data = await res.json();
                if (!data.html) throw new Error('empty');

                currentHTML = data.html;
                currentSiteId = data.site_id || siteId;

                previewId.textContent = currentSiteId;
                previewBizName.textContent = data.meta?.biz_name || 'Site-ul tƒÉu';

                iframe.srcdoc = currentHTML;

                // Setup download button
                document.getElementById('btn-dl').onclick = () => {
                    const blob = new Blob([currentHTML], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${(data.meta?.biz_name || 'site').toLowerCase().replace(/\s+/g, '-')}-${currentSiteId}.html`;
                    a.click();
                    URL.revokeObjectURL(url);
                };

                // Update URL bar without reload
                history.replaceState({}, '', `?id=${currentSiteId}`);

                loadingScreen.style.display = 'none';
                previewScreen.style.display = 'flex';
                previewScreen.style.flexDirection = 'column';
                previewScreen.style.flex = '1';

            } catch (err) {
                loadingScreen.style.display = 'none';
                lookupScreen.style.display = 'flex';
                showError('ID-ul introdus nu a fost gƒÉsit. VerificƒÉ codul primit dupƒÉ generare.');
            }
        }

        function goBack() {
            previewScreen.style.display = 'none';
            lookupScreen.style.display = 'flex';
            iframe.srcdoc = '';
            history.replaceState({}, '', window.location.pathname);
        }

        function shareLink() {
            const url = `${window.location.origin}/view?id=${currentSiteId}`;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(url).then(() => showToast());
            } else {
                // Fallback
                const tmp = document.createElement('input');
                tmp.value = url;
                document.body.appendChild(tmp);
                tmp.select();
                document.execCommand('copy');
                document.body.removeChild(tmp);
                showToast();
            }
        }

        function showToast() {
            const toast = document.getElementById('share-toast');
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }

        function showError(msg) {
            errorMsg.textContent = msg;
            errorMsg.style.display = 'block';
            input.focus();
        }
    </script>
</body>

</html>